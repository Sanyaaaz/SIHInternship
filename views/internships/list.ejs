<div class="min-h-screen bg-background py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Find Internships</h1>
            <p class="text-gray-600">Discover your next opportunity from <%= totalResults %> available positions</p>
        </div>

        <!-- Search Bar -->
        <form action="/internships" method="GET" class="mb-6">
            <div class="flex flex-col lg:flex-row gap-4 p-6 bg-white rounded-lg shadow-sm border border-gray-200">
                <div class="flex-1 relative">
                    <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"></i>
                    <input
                        type="text"
                        name="search"
                        value="<%= filters.search || '' %>"
                        placeholder="Job title, company, or skills"
                        class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none"
                    />
                </div>
                
                <div class="flex-1 relative">
                    <i data-lucide="map-pin" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"></i>
                    <input
                        type="text"
                        name="location"
                        value="<%= filters.location || '' %>"
                        placeholder="Location"
                        class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none"
                    />
                </div>
                
                <div class="flex gap-2">
                    <button
                        type="button"
                        onclick="toggleFilters()"
                        class="flex items-center space-x-2 px-4 py-3 border border-gray-200 rounded-lg transition-colors hover:bg-gray-50"
                        id="filterToggle"
                    >
                        <i data-lucide="filter" class="h-5 w-5"></i>
                        <span>Filters</span>
                    </button>
                    
                    <button
                        type="submit"
                        class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors"
                    >
                        Search
                    </button>
                </div>
            </div>

            <!-- Advanced Filters -->
            <div id="advancedFilters" class="hidden mt-4 p-6 bg-white rounded-lg shadow-sm border border-gray-200">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-medium text-gray-900">Advanced Filters</h3>
                    <button type="button" onclick="clearFilters()" class="text-gray-600 hover:text-gray-800 text-sm">
                        Clear All
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Type</label>
                        <select name="type" class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none">
                            <option value="">All Types</option>
                            <option value="Full-time" <%= filters.type === 'Full-time' ? 'selected' : '' %>>Full-time</option>
                            <option value="Part-time" <%= filters.type === 'Part-time' ? 'selected' : '' %>>Part-time</option>
                            <option value="Remote" <%= filters.type === 'Remote' ? 'selected' : '' %>>Remote</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Duration</label>
                        <select name="duration" class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none">
                            <option value="">All Durations</option>
                            <option value="3" <%= filters.duration === '3' ? 'selected' : '' %>>3 months</option>
                            <option value="4" <%= filters.duration === '4' ? 'selected' : '' %>>4 months</option>
                            <option value="5" <%= filters.duration === '5' ? 'selected' : '' %>>5 months</option>
                            <option value="6" <%= filters.duration === '6' ? 'selected' : '' %>>6 months</option>
                        </select>
                    </div>
                    
                    <div class="flex items-end">
                        <button type="submit" class="w-full px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
                            Apply Filters
                        </button>
                    </div>
                </div>
            </div>
        </form>

        <!-- Results -->
        <div class="mb-6">
            <p class="text-gray-600">
                Showing <%= internships.length %> of <%= totalResults %> internships
                <% if (pagination.current > 1) { %>
                    (Page <%= pagination.current %> of <%= pagination.total %>)
                <% } %>
            </p>
        </div>

        <!-- Internship Grid -->
        <% if (internships && internships.length > 0) { %>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <% internships.forEach(internship => { %>
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-all duration-200 hover:border-gray-300 group">
                        <div class="p-6">
                            <!-- Header -->
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-start space-x-3">
                                    <div class="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center">
                                        <i data-lucide="building" class="h-6 w-6 text-gray-600"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-900 group-hover:text-primary transition-colors">
                                            <%= internship.title %>
                                        </h3>
                                        <p class="text-gray-600 font-medium"><%= internship.company %></p>
                                    </div>
                                </div>
                                <div class="px-2 py-1 rounded-md text-xs font-medium border 
                                    <%= internship.type === 'Remote' ? 'bg-green-100 text-green-800 border-green-200' : 
                                        internship.type === 'Part-time' ? 'bg-blue-100 text-blue-800 border-blue-200' : 
                                        'bg-gray-100 text-gray-800 border-gray-200' %>">
                                    <%= internship.type %>
                                </div>
                            </div>

                            <!-- Details -->
                            <div class="space-y-2 mb-4">
                                <div class="flex items-center text-gray-600 text-sm">
                                    <i data-lucide="map-pin" class="h-4 w-4 mr-2 text-gray-400"></i>
                                    <%= internship.location %>
                                </div>
                                <div class="flex items-center text-gray-600 text-sm">
                                    <i data-lucide="clock" class="h-4 w-4 mr-2 text-gray-400"></i>
                                    <%= internship.duration %>
                                </div>
                                <div class="flex items-center text-gray-600 text-sm">
                                    <i data-lucide="dollar-sign" class="h-4 w-4 mr-2 text-gray-400"></i>
                                    <%= internship.stipend %>
                                </div>
                                <div class="flex items-center text-gray-600 text-sm">
                                    <i data-lucide="calendar" class="h-4 w-4 mr-2 text-gray-400"></i>
                                    Apply by <%= new Date(internship.applicationDeadline).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %>
                                </div>
                            </div>

                            <!-- Description -->
                            <p class="text-gray-700 text-sm mb-4 line-clamp-3">
                                <%= internship.description.substring(0, 120) %>...
                            </p>

                            <!-- Skills -->
                            <div class="flex flex-wrap gap-2 mb-4">
                                <% internship.skills.slice(0, 3).forEach(skill => { %>
                                    <span class="px-2 py-1 bg-indigo-50 text-primary text-xs font-medium rounded-md">
                                        <%= skill %>
                                    </span>
                                <% }) %>
                                <% if (internship.skills.length > 3) { %>
                                    <span class="px-2 py-1 bg-gray-50 text-gray-600 text-xs font-medium rounded-md">
                                        +<%= internship.skills.length - 3 %> more
                                    </span>
                                <% } %>
                            </div>

                            <!-- Actions -->
                            <div class="flex items-center justify-between pt-4 border-t border-gray-100">
                                <p class="text-xs text-gray-500">
                                    Posted <%= new Date(internship.createdAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %>
                                </p>
                                <div class="flex items-center space-x-3">
                                    <a
                                        href="/internships/<%= internship._id %>"
                                        class="flex items-center space-x-1 text-primary hover:text-primary/80 text-sm font-medium transition-colors"
                                    >
                                        <span>View Details</span>
                                        <i data-lucide="external-link" class="h-4 w-4"></i>
                                    </a>
                                    <% if (appliedInternships.includes(internship._id.toString())) { %>
                                        <span class="px-4 py-2 bg-green-100 text-green-800 text-sm font-medium rounded-md border border-green-200">
                                            Applied ✓
                                        </span>
                                    <% } else { %>
                                        <a
                                            href="/internships/<%= internship._id %>"
                                            class="px-4 py-2 bg-secondary text-white text-sm font-medium rounded-md hover:bg-secondary/90 transition-colors"
                                        >
                                            Apply Now
                                        </a>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    </div>
                <% }) %>
            </div>

            <!-- Pagination -->
            <% if (pagination.total > 1) { %>
                <div class="flex items-center justify-center space-x-2">
                    <% if (pagination.hasPrev) { %>
                        <a href="?page=<%= pagination.current - 1 %><%= filters.search ? '&search=' + encodeURIComponent(filters.search) : '' %><%= filters.location ? '&location=' + encodeURIComponent(filters.location) : '' %><%= filters.type ? '&type=' + encodeURIComponent(filters.type) : '' %><%= filters.duration ? '&duration=' + encodeURIComponent(filters.duration) : '' %>" 
                           class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                            Previous
                        </a>
                    <% } %>
                    
                    <% for (let i = Math.max(1, pagination.current - 2); i <= Math.min(pagination.total, pagination.current + 2); i++) { %>
                        <a href="?page=<%= i %><%= filters.search ? '&search=' + encodeURIComponent(filters.search) : '' %><%= filters.location ? '&location=' + encodeURIComponent(filters.location) : '' %><%= filters.type ? '&type=' + encodeURIComponent(filters.type) : '' %><%= filters.duration ? '&duration=' + encodeURIComponent(filters.duration) : '' %>" 
                           class="px-4 py-2 <%= i === pagination.current ? 'bg-primary text-white' : 'border border-gray-300 hover:bg-gray-50' %> rounded-lg transition-colors">
                            <%= i %>
                        </a>
                    <% } %>
                    
                    <% if (pagination.hasNext) { %>
                        <a href="?page=<%= pagination.current + 1 %><%= filters.search ? '&search=' + encodeURIComponent(filters.search) : '' %><%= filters.location ? '&location=' + encodeURIComponent(filters.location) : '' %><%= filters.type ? '&type=' + encodeURIComponent(filters.type) : '' %><%= filters.duration ? '&duration=' + encodeURIComponent(filters.duration) : '' %>" 
                           class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                            Next
                        </a>
                    <% } %>
                </div>
            <% } %>
        <% } else { %>
            <div class="text-center py-12">
                <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="search" class="h-12 w-12 text-gray-400"></i>
                </div>
                <h3 class="text-xl font-medium text-gray-900 mb-2">No internships found</h3>
                <p class="text-gray-600 mb-4">Try adjusting your search criteria or filters</p>
                <button
                    onclick="clearFilters()"
                    class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors"
                >
                    Clear Filters
                </button>
            </div>
        <% } %>
    </div>
</div>

<script>
function toggleFilters() {
    const filters = document.getElementById('advancedFilters');
    const toggle = document.getElementById('filterToggle');
    
    if (filters.classList.contains('hidden')) {
        filters.classList.remove('hidden');
        toggle.classList.add('bg-primary', 'text-white');
        toggle.classList.remove('hover:bg-gray-50');
    } else {
        filters.classList.add('hidden');
        toggle.classList.remove('bg-primary', 'text-white');
        toggle.classList.add('hover:bg-gray-50');
    }
}

function clearFilters() {
    window.location.href = '/internships';
}

// Show filters if any are active
<% if (filters.type || filters.duration) { %>
    document.addEventListener('DOMContentLoaded', function() {
        toggleFilters();
    });
<% } %>
</script>